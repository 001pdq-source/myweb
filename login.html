<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول - حكاية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <h1 class="auth-logo">حكاية</h1>
            <h2 class="auth-title">تسجيل الدخول</h2>

            <form id="loginForm">
                <div class="form-group">
                    <label for="email" class="form-label">البريد الإلكتروني</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="أدخل بريدك الإلكتروني"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">كلمة المرور</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="أدخل كلمة المرور"
                        required
                    >
                </div>

                <div id="errorMessage" class="error-message"></div>

                <button type="submit" class="form-button">تسجيل الدخول</button>
            </form>

            <div class="auth-link">
                ليس لديك حساب؟ 
                <a href="./register.html">إنشاء حساب جديد</a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbWJ_75F3RLUIBVRz2NpgpgLJKm0o1Jm8",
            authDomain: "my-web-6111b.firebaseapp.com",
            projectId: "my-web-6111b",
            storageBucket: "my-web-6111b.firebasestorage.app",
            messagingSenderId: "540400864980",
            appId: "1:540400864980:web:df73e331638a07b2977541",
            measurementId: "G-7729MX6D3Q"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
    </script>

    <script type="module">
        import { loginUser } from "./auth.js";

        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');

        // Load theme on page load
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const button = loginForm.querySelector('.form-button');

            // Show loading state
            button.disabled = true;
            button.innerHTML = '<span class="loading-spinner"></span> جاري التحميل...';

            const result = await loginUser(email, password);

            if (result.success) {
                // Redirect to index.html on successful login
                window.location.href = './index.html';
            } else {
                // Show error message
                errorMessage.textContent = result.error || 'حدث خطأ في تسجيل الدخول';
                errorMessage.classList.add('show');

                // Reset button
                button.disabled = false;
                button.innerHTML = 'تسجيل الدخول';
            }
        });

        // Toggle theme
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const isDarkMode = document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                });
            }
        });
    </script>
</body>
</html>
