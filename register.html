<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حساب - حكاية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <h1 class="auth-logo">حكاية</h1>
            <h2 class="auth-title">إنشاء حساب جديد</h2>

            <form id="registerForm">
                <div class="form-group">
                    <label for="email" class="form-label">البريد الإلكتروني</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="أدخل بريدك الإلكتروني"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">كلمة المرور</label>
                    <input 
                        type="password" 
                        id="password" 
                        class="form-input" 
                        placeholder="أدخل كلمة المرور (6 أحرف على الأقل)"
                        required
                        minlength="6"
                    >
                </div>

                <div class="form-group">
                    <label for="confirmPassword" class="form-label">تأكيد كلمة المرور</label>
                    <input 
                        type="password" 
                        id="confirmPassword" 
                        class="form-input" 
                        placeholder="أكد كلمة المرور"
                        required
                        minlength="6"
                    >
                </div>

                <div id="errorMessage" class="error-message"></div>

                <button type="submit" class="form-button">إنشاء حساب</button>
            </form>

            <div class="auth-link">
                لديك حساب بالفعل؟ 
                <a href="./login.html">تسجيل الدخول</a>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAbWJ_75F3RLUIBVRz2NpgpgLJKm0o1Jm8",
            authDomain: "my-web-6111b.firebaseapp.com",
            projectId: "my-web-6111b",
            storageBucket: "my-web-6111b.firebasestorage.app",
            messagingSenderId: "540400864980",
            appId: "1:540400864980:web:df73e331638a07b2977541",
            measurementId: "G-7729MX6D3Q"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
    </script>

    <script type="module">
        import { registerUser } from "./auth.js";

        const registerForm = document.getElementById('registerForm');
        const errorMessage = document.getElementById('errorMessage');

        // Load theme on page load
        const theme = localStorage.getItem('theme') || 'light';
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
        }

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const button = registerForm.querySelector('.form-button');

            // Validate passwords match
            if (password !== confirmPassword) {
                errorMessage.textContent = 'كلمات المرور غير متطابقة';
                errorMessage.classList.add('show');
                return;
            }

            // Validate password length
            if (password.length < 6) {
                errorMessage.textContent = 'كلمة المرور يجب أن تكون 6 أحرف على الأقل';
                errorMessage.classList.add('show');
                return;
            }

            // Show loading state
            button.disabled = true;
            button.innerHTML = '<span class="loading-spinner"></span> جاري الإنشاء...';
            errorMessage.classList.remove('show');

            const result = await registerUser(email, password);

            if (result.success) {
                // Redirect to login page on successful registration
                window.location.href = './login.html';
            } else {
                // Show error message
                let errorText = result.error;

                // Parse Firebase error messages
                if (result.error.includes('email-already-in-use')) {
                    errorText = 'هذا البريد الإلكتروني مسجل بالفعل';
                } else if (result.error.includes('invalid-email')) {
                    errorText = 'البريد الإلكتروني غير صحيح';
                } else if (result.error.includes('operation-not-allowed')) {
                    errorText = 'هذه الخدمة غير متاحة حالياً';
                } else if (result.error.includes('weak-password')) {
                    errorText = 'كلمة المرور ضعيفة جداً';
                }

                errorMessage.textContent = errorText;
                errorMessage.classList.add('show');

                // Reset button
                button.disabled = false;
                button.innerHTML = 'إنشاء حساب';
            }
        });

        // Toggle theme
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.querySelector('.theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const isDarkMode = document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                });
            }
        });
    </script>
</body>
</html>
